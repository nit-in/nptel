name: NPTEL

on:
  workflow_dispatch:
    inputs:
      desc:
        description: 'Enter the appropriate data in the following sections'
        default: 'DO NOT EDIT THIS LEAVE THIS AS IS'
        
      courseId:
        description: 'Course id of the course you want to download'
        required: true
        type: string
        
      customTag:
        description: 'NPTEL Course Name (in place of space use underscore (_) )'
        required: true
        default: 'NPTEL_Tag'
        type: string


jobs:

  nptel_vids:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: setting_up
        env:
          ACTIONS_ALLOW_UNSECURE_COMMANDS: 'true'
        run:  |
          sudo apt update
          sudo apt install --fix-missing -y python3 aria2 wkhtmltopdf fd-find poppler-utils
          sudo ln -s $(which fdfind) /usr/bin/fd
          sudo pip install -r requirements.txt
          mkdir -p /home/runner/nptel
          sudo pip install -U pyopenssl cryptography || echo "upgrade failed"
          
      - name: set env
        run:  |
          echo ${{ inputs.customTag }}
          echo NPTEL_TAG=${{ inputs.customTag }} >> $GITHUB_ENV
          
      - name: run script
        run:  |
          source .env
          nptel ${{ inputs.courseId }}

      - name: Create release
        uses: ncipollo/release-action@v1.14.0
        with:
          artifacts: "/home/runner/nptel_videos/**/*.mp4"
          token: ${{ secrets.NPTEL }}
          tag: "NPTEL_${{ env.NPTEL_TAG }}"
          allowUpdates: true
          body : "NPTEL videos for course Id ${{ env.NPTEL_TAG }}"
